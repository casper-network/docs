"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[2870],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return h}});var n=a(7294);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,s=function(e,t){if(null==e)return{};var a,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}var i=n.createContext({}),d=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=d(e.components);return n.createElement(i.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,s=e.mdxType,r=e.originalType,i=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),p=d(a),m=s,h=p["".concat(i,".").concat(m)]||p[m]||u[m]||r;return a?n.createElement(h,l(l({ref:t},c),{},{components:a})):n.createElement(h,l({ref:t},c))}));function h(e,t){var a=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var r=a.length,l=new Array(r);l[0]=m;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o[p]="string"==typeof e?e:s,l[1]=o;for(var d=2;d<r;d++)l[d]=a[d];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},7698:function(e,t,a){a.r(t),a.d(t,{assets:function(){return c},contentTitle:function(){return i},default:function(){return h},frontMatter:function(){return o},metadata:function(){return d},toc:function(){return p}});var n=a(7462),s=a(3366),r=(a(7294),a(3905)),l=["components"],o={title:"Multi-Sig Workflow"},i="Multi-Signature Workflow",d={unversionedId:"resources/advanced/multi-sig/multi-sig-workflow",id:"resources/advanced/multi-sig/multi-sig-workflow",title:"Multi-Sig Workflow",description:"The purpose of this tutorial is to provide an example of how to integrate key management on Casper accounts. This guide assumes previous completion of the Two-Party Multi-Signature Deploys tutorial, among other prerequisites. You will also need the Casper CLI client to use the make-deploy, sign-deploy, and send-deploy Casper CLI client commands.",source:"@site/source/docs/casper/resources/advanced/multi-sig/multi-sig-workflow.md",sourceDirName:"resources/advanced/multi-sig",slug:"/resources/advanced/multi-sig/multi-sig-workflow",permalink:"/resources/advanced/multi-sig/multi-sig-workflow",draft:!1,editUrl:"https://github.com/casper-network/docs/tree/dev/source/docs/casper/resources/advanced/multi-sig/multi-sig-workflow.md",tags:[],version:"current",lastUpdatedAt:1701098456,formattedLastUpdatedAt:"Nov 27, 2023",frontMatter:{title:"Multi-Sig Workflow"},sidebar:"resources",previous:{title:"Introduction",permalink:"/resources/advanced/multi-sig/"},next:{title:"Additional Examples",permalink:"/resources/advanced/multi-sig/other-scenarios"}},c={},p=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Session Code Required for Key Management",id:"session-code-required-for-key-management",level:2},{value:"Tutorial Workflow",id:"tutorial-workflow",level:2},{value:"Step 1: Clone the example Wasm for this workflow",id:"step-1-clone-the-example-wasm-for-this-workflow",level:3},{value:"Step 2: Build the sample Wasm provided",id:"step-2-build-the-sample-wasm-provided",level:3},{value:"Step 3: Increase the primary key&#39;s weight to set thresholds",id:"step-3-increase-the-primary-keys-weight-to-set-thresholds",level:3},{value:"Step 4: Update the account&#39;s action thresholds",id:"step-4-update-the-accounts-action-thresholds",level:3},{value:"Step 5: Add associated keys to the primary account",id:"step-5-add-associated-keys-to-the-primary-account",level:3},{value:"Step 6: Send a deploy from the primary account",id:"step-6-send-a-deploy-from-the-primary-account",level:3},{value:"Step 7: Send a multi-signature deploy from an associated key",id:"step-7-send-a-multi-signature-deploy-from-an-associated-key",level:3},{value:"Removing a Compromised Key",id:"removing-a-compromised-key",level:2},{value:"Next Steps",id:"next-steps",level:2}],u={toc:p},m="wrapper";function h(e){var t=e.components,a=(0,s.Z)(e,l);return(0,r.kt)(m,(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"multi-signature-workflow"},"Multi-Signature Workflow"),(0,r.kt)("p",null,"The purpose of this tutorial is to provide an example of how to integrate key management on Casper accounts. This guide assumes previous completion of the ",(0,r.kt)("a",{parentName:"p",href:"/resources/tutorials/advanced/two-party-multi-sig"},"Two-Party Multi-Signature Deploys")," tutorial, among other prerequisites. You will also need the Casper CLI client to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"make-deploy"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"sign-deploy"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"send-deploy")," Casper CLI client commands."),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"Understanding the multi-sig feature and trying it out on Testnet before using it on Mainnet is essential. Incorrect account configurations could render accounts unusable, and you could lose access to all the corresponding CSPR tokens.")),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"The following prerequisites are required for this workflow:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Set up all the ",(0,r.kt)("a",{parentName:"li",href:"/developers/prerequisites"},"development environment prerequisites"),", including a ",(0,r.kt)("a",{parentName:"li",href:"/developers/prerequisites#setting-up-an-account"},"funded account")," and the ",(0,r.kt)("a",{parentName:"li",href:"/developers/prerequisites#the-casper-command-line-client"},"Casper CLI client")),(0,r.kt)("li",{parentName:"ol"},"Complete the ",(0,r.kt)("a",{parentName:"li",href:"/resources/tutorials/advanced/two-party-multi-sig"},"Two-Party Multi-Signature Deploys")," workflow and set up the source account for multi-signature deploys"),(0,r.kt)("li",{parentName:"ol"},"Understand the Casper ",(0,r.kt)("a",{parentName:"li",href:"/concepts/design/casper-design#accounts-head"},"account-based model")," before proceeding")),(0,r.kt)("h2",{id:"session-code-required-for-key-management"},"Session Code Required for Key Management"),(0,r.kt)("p",null,"To manage an account's associated keys and thresholds, you must run session code that executes within the account's context. Note that the session code provided in this workflow is not a general-purpose program and needs to be modified for each use case."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Do not run these examples on Mainnet. Update each command for your environment.")),(0,r.kt)("h2",{id:"tutorial-workflow"},"Tutorial Workflow"),(0,r.kt)("h3",{id:"step-1-clone-the-example-wasm-for-this-workflow"},"Step 1: Clone the example Wasm for this workflow"),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/casper-ecosystem/tutorials-example-wasm/tree/dev/multi-sig"},"multi-sig GitHub repository")," contains session code that can be used for learning how to configure Casper accounts using associated keys and multi-signature deploys. Clone the repository and navigate to the corresponding folder."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/casper-ecosystem/tutorials-example-wasm/ && cd multi-sig\n")),(0,r.kt)("p",null,"If you take a look at the repository structure and open the ",(0,r.kt)("inlineCode",{parentName:"p"},"contracts")," folder, you will see session code with different functionality:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"add_account.wasm")," - adds an associated account with a specified weight"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"update_associated_keys.wasm")," - updates a key\u2019s weight"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"update_thresholds.wasm")," - updates the account's action thresholds for deployment and account management"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"remove_account.wasm")," - removes an associated account from the primary account")),(0,r.kt)("h3",{id:"step-2-build-the-sample-wasm-provided"},"Step 2: Build the sample Wasm provided"),(0,r.kt)("p",null,"Prepare your environment, build and test the session code provided with the following commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rustup update\nmake prepare\nmake test\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"rustup update")," - checks and updates your Rust installation"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"make prepare")," - sets the Wasm target"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"make test")," - builds and verifies the session code")),(0,r.kt)("p",null,"Note that in the test folder there is a ",(0,r.kt)("inlineCode",{parentName:"p"},"contract.wasm")," that is needed for the tests to pass. If you run ",(0,r.kt)("inlineCode",{parentName:"p"},"make clean")," that file will be deleted."),(0,r.kt)("h3",{id:"step-3-increase-the-primary-keys-weight-to-set-thresholds"},"Step 3: Increase the primary key's weight to set thresholds"),(0,r.kt)("p",null,"This workflow starts by increasing the weight of the primary key from 1 to 3. To make account updates, a key's weight must equal or exceed the ",(0,r.kt)("inlineCode",{parentName:"p"},"key_management")," threshold. In a later step, you will add the associated accounts that will participate in signing deploys."),(0,r.kt)("p",null,"Retrieve the account hash of the primary key you are working with using a block explorer or the Casper CLI client."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client account-address --public-key <INSERT_PUBLIC_KEY_HEX>\n")),(0,r.kt)("p",null,"Update the weight of the primary key to 3 by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"update_associated_keys.wasm"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'casper-client put-deploy --node-address https://rpc.testnet.casperlabs.io/ \\\n--chain-name "casper-test" \\\n--payment-amount 500000000 \\\n--secret-key $PATH/secret_key.pem \\\n--session-path target/wasm32-unknown-unknown/release/update_associated_keys.wasm \\\n--session-arg "associated_key:key=\'account-hash-<ACCOUNT_HASH>\'" \\\n--session-arg "new_weight:u8=\'3\'"\n')),(0,r.kt)("p",null,"Verify that the deploy ran successfully."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-deploy --node-address https://rpc.testnet.casperlabs.io/ <DEPLOY_HASH>\n")),(0,r.kt)("p",null,"Retrieve the latest state root hash and check the primary account details."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-state-root-hash --node-address https://rpc.testnet.casperlabs.io/\n\ncasper-client query-global-state \\\n--node-address https://rpc.testnet.casperlabs.io/ \\\n--state-root-hash <STATE_ROOT_HASH> \\\n--key account-hash-<PRIMARY_ACCOUNT_HASH>\n")),(0,r.kt)("p",null,"The primary key in this account should now have weight 3."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Account details"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"Account": {\n  "account_hash": "account-hash-1ed5a1c39bea93c105f2d22c965a84b205b36734a377d05dbb103b6bfaa595a7",\n  "action_thresholds": {\n    "deployment": 1,\n    "key_management": 1\n  },\n  "associated_keys": [\n    {\n      "account_hash": "account-hash-1ed5a1c39bea93c105f2d22c965a84b205b36734a377d05dbb103b6bfaa595a7",\n      "weight": 3\n    }\n  ],\n  "main_purse": "uref-8294864177c2c1ec887a11dae095e487b5256ce6bd2a1f2740d0e4f28bd3251c-007",\n  "named_keys": []\n}\n'))),(0,r.kt)("p",null,"The table below summarizes the updates."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Threshold / Key"),(0,r.kt)("th",{parentName:"tr",align:null},"Previous weight"),(0,r.kt)("th",{parentName:"tr",align:null},"Current weight"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"deployment")),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"key_management")),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Primary key (",(0,r.kt)("inlineCode",{parentName:"td"},"1ed5..."),")"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"3")))),(0,r.kt)("h3",{id:"step-4-update-the-accounts-action-thresholds"},"Step 4: Update the account's action thresholds"),(0,r.kt)("p",null,"Set up a multi-signature scheme for the account by updating the ",(0,r.kt)("inlineCode",{parentName:"p"},"deployment")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"key_management")," thresholds. The ",(0,r.kt)("inlineCode",{parentName:"p"},"update_thresholds.wasm")," will take two arguments and set the ",(0,r.kt)("inlineCode",{parentName:"p"},"deployment")," threshold to 2 and the ",(0,r.kt)("inlineCode",{parentName:"p"},"key_management")," threshold to 3."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client put-deploy \\\n--node-address https://rpc.testnet.casperlabs.io \\\n--chain-name casper-test \\\n--payment-amount 500000000 \\\n--secret-key $PATH/secret_key.pem \\\n--session-path target/wasm32-unknown-unknown/release/update_thresholds.wasm \\\n--session-arg \"deployment_threshold:u8='2'\" \\\n--session-arg \"key_management_threshold:u8='3'\"\n")),(0,r.kt)("p",null,"Verify that the deploy ran successfully."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-deploy --node-address https://rpc.testnet.casperlabs.io/ <DEPLOY_HASH>\n")),(0,r.kt)("p",null,"Retrieve the latest state root hash and check the primary account details."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-state-root-hash --node-address https://rpc.testnet.casperlabs.io/\n\ncasper-client query-global-state \\\n--node-address https://rpc.testnet.casperlabs.io/ \\\n--state-root-hash <STATE_ROOT_HASH> \\\n--key account-hash-<PRIMARY_ACCOUNT_HASH>\n")),(0,r.kt)("p",null,"The account's action thresholds should look like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"action_thresholds": {\n  "deployment": 2,\n  "key_management": 3\n},\n')),(0,r.kt)("p",null,"This account configuration requires a cumulative weight of 3 to manage keys and a cumulative weight of 2 to send deploys. For example, if two associated keys have weight 1, they must both sign and send the deploy as part of this account context. The cumulative weight of these two keys would not meet the threshold for key management."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Account details"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"Account": {\n  "account_hash": "account-hash-1ed5a1c39bea93c105f2d22c965a84b205b36734a377d05dbb103b6bfaa595a7",\n  "action_thresholds": {\n    "deployment": 2,\n    "key_management": 3\n  },\n  "associated_keys": [\n    {\n      "account_hash": "account-hash-1ed5a1c39bea93c105f2d22c965a84b205b36734a377d05dbb103b6bfaa595a7",\n      "weight": 3\n    }\n  ],\n  "main_purse": "uref-8294864177c2c1ec887a11dae095e487b5256ce6bd2a1f2740d0e4f28bd3251c-007",\n  "named_keys": []\n}\n'))),(0,r.kt)("p",null,"The table below summarizes the updates."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Threshold / Key"),(0,r.kt)("th",{parentName:"tr",align:null},"Previous weight"),(0,r.kt)("th",{parentName:"tr",align:null},"Current weight"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"deployment")),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"2")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"key_management")),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"3")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Primary key (",(0,r.kt)("inlineCode",{parentName:"td"},"1ed5..."),")"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"3")))),(0,r.kt)("h3",{id:"step-5-add-associated-keys-to-the-primary-account"},"Step 5: Add associated keys to the primary account"),(0,r.kt)("p",null,"To add an associated key to the primary account, use the ",(0,r.kt)("inlineCode",{parentName:"p"},"add_account.wasm")," provided. This example adds two keys to the primary account (",(0,r.kt)("inlineCode",{parentName:"p"},"account-hash-d89c*"),"): ",(0,r.kt)("inlineCode",{parentName:"p"},"user_1")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"account-hash-e2d0*"),", and ",(0,r.kt)("inlineCode",{parentName:"p"},"user_2")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"account-hash-04a9*"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'casper-client put-deploy --node-address https://rpc.testnet.casperlabs.io/ \\\n--chain-name "casper-test" \\\n--payment-amount 500000000 \\\n--secret-key $PATH/secret_key.pem \\\n--session-path target/wasm32-unknown-unknown/release/add_account.wasm \\\n--session-arg "new_key:key=\'account-hash-e2d00525cac31ae2756fb155f289d276c6945b6914923fe275de0cb127bffee7" \\\n--session-arg "weight:u8=\'1\'"\n')),(0,r.kt)("p",null,"Verify that the deploy ran successfully."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-deploy --node-address https://rpc.testnet.casperlabs.io/ <DEPLOY_HASH>\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'casper-client put-deploy --node-address https://rpc.testnet.casperlabs.io/ \\\n--chain-name "casper-test" \\\n--payment-amount 500000000 \\\n--secret-key $PATH/secret_key.pem \\\n--session-path target/wasm32-unknown-unknown/release/add_account.wasm \\\n--session-arg "new_key:key=\'account-hash-04a9691a9f8f05a0f08bd686f188b27c7dbcd644b415759fd3ca043d916ea02f" \\\n--session-arg "weight:u8=\'1\'"\n')),(0,r.kt)("p",null,"Verify that the deploy ran successfully."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-deploy --node-address https://rpc.testnet.casperlabs.io/ <DEPLOY_HASH>\n")),(0,r.kt)("p",null,"Retrieve the latest state root hash and check the primary account details."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-state-root-hash --node-address https://rpc.testnet.casperlabs.io/\n\ncasper-client query-global-state \\\n--node-address https://rpc.testnet.casperlabs.io/ \\\n--state-root-hash <STATE_ROOT_HASH> \\\n--key account-hash-<PRIMARY_ACCOUNT_HASH>\n")),(0,r.kt)("p",null,"Now, the account should have one primary key with weight 3, and two associated accounts, each with weight 1."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Account details"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"Account": {\n  "account_hash": "account-hash-1ed5a1c39bea93c105f2d22c965a84b205b36734a377d05dbb103b6bfaa595a7",\n  "action_thresholds": {\n    "deployment": 2,\n    "key_management": 3\n  },\n  "associated_keys": [\n    {\n      "account_hash": "account-hash-04a9691a9f8f05a0f08bd686f188b27c7dbcd644b415759fd3ca043d916ea02f",\n      "weight": 1\n    },\n    {\n      "account_hash": "account-hash-1ed5a1c39bea93c105f2d22c965a84b205b36734a377d05dbb103b6bfaa595a7",\n      "weight": 3\n    },\n    {\n      "account_hash": "account-hash-e2d00525cac31ae2756fb155f289d276c6945b6914923fe275de0cb127bffee7",\n      "weight": 1\n    }\n  ],\n  "main_purse": "uref-8294864177c2c1ec887a11dae095e487b5256ce6bd2a1f2740d0e4f28bd3251c-007",\n  "named_keys": []\n}\n'))),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("ol",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ol"},"All associated keys should be kept incredibly secure to ensure the security and integrity of the account."),(0,r.kt)("li",{parentName:"ol"},"After all associated keys and action thresholds have been set to the desired multi-signature scheme, the weight of the original primary key can be increased or lowered, depending on your use case. Be careful with this! If you lower the primary key's weight below the key management threshold, the account will require multiple signatures for key management. The account will be unusable if you do not have enough associated keys set up."))),(0,r.kt)("p",null,"The table below summarizes the updates."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Threshold / Key"),(0,r.kt)("th",{parentName:"tr",align:null},"Previous weight"),(0,r.kt)("th",{parentName:"tr",align:null},"Current weight"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"deployment")),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"2")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"key_management")),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"3")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Primary key (",(0,r.kt)("inlineCode",{parentName:"td"},"1ed5..."),")"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"3")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Associated key (",(0,r.kt)("inlineCode",{parentName:"td"},"04a9..."),")"),(0,r.kt)("td",{parentName:"tr",align:null},"N/A"),(0,r.kt)("td",{parentName:"tr",align:null},"1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Associated key (",(0,r.kt)("inlineCode",{parentName:"td"},"e2d0..."),")"),(0,r.kt)("td",{parentName:"tr",align:null},"N/A"),(0,r.kt)("td",{parentName:"tr",align:null},"1")))),(0,r.kt)("h3",{id:"step-6-send-a-deploy-from-the-primary-account"},"Step 6: Send a deploy from the primary account"),(0,r.kt)("p",null,"This step sends a deploy containing Wasm (",(0,r.kt)("inlineCode",{parentName:"p"},"contract.wasm"),"), which adds a named key to the account. The source code for the Wasm comes from the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/casper-ecosystem/hello-world"},"hello-world")," repository. The deploy should succeed as the primary account has a weight of 3, which is greater than the deployment threshold."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client put-deploy --chain-name casper-test \\\n--payment-amount 3000000000 \\\n--session-path tests/wasm/contract.wasm \\\n--secret-key $PATH/secret_key.pem \\\n--session-arg \"my-key-name:string='primary_account_key'\" \\\n--session-arg \"message:string='Hello, World'\"\n")),(0,r.kt)("p",null,"Verify that the deploy ran successfully."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-deploy --node-address https://rpc.testnet.casperlabs.io/ <DEPLOY_HASH>\n")),(0,r.kt)("p",null,"Retrieve the latest state root hash and check the primary account details."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-state-root-hash --node-address https://rpc.testnet.casperlabs.io/\n\ncasper-client query-global-state \\\n--node-address https://rpc.testnet.casperlabs.io/ \\\n--state-root-hash <STATE_ROOT_HASH> \\\n--key account-hash-<PRIMARY_ACCOUNT_HASH>\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"hello_world.wasm")," should have run and added a named key to the account."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"named_keys": [\n  {\n    "key": "uref-9b9ecaa9e5e235fc6955d4d528cb1b5b38f2d800f6cbbc55351131a3701b5a81-007",\n    "name": "my-key-name"\n  }\n]\n')),(0,r.kt)("h3",{id:"step-7-send-a-multi-signature-deploy-from-an-associated-key"},"Step 7: Send a multi-signature deploy from an associated key"),(0,r.kt)("p",null,"Given the multi-signature scheme set up in this example, two associated keys need to sign to send a deploy from one of the associated keys. This example uses the following commands to sign a deploy with multiple keys and send it to the network:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"make-deploy")," - creates and signs a deploy, saving the output to a file"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"sign-deploy")," - adds additional signatures for a multi-signature deploy"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"send-deploy")," - sends the deploy to the network")),(0,r.kt)("p",null,"Similar to step 6, this example uses Wasm (",(0,r.kt)("inlineCode",{parentName:"p"},"contract.wasm"),"), which adds a named key to the account. The deploy originates from the primary account, specified with the ",(0,r.kt)("inlineCode",{parentName:"p"},"--session-account")," argument. The deploy needs two signatures to meet the ",(0,r.kt)("inlineCode",{parentName:"p"},"deployment")," weight equal to 2. Once both associated keys sign the deploy, either can send it to the network."),(0,r.kt)("p",null,"When using the ",(0,r.kt)("inlineCode",{parentName:"p"},"--session-account")," argument, specify the hex-encoded public key of the primary account context under which the session code will be executed."),(0,r.kt)("p",null,"One associated key creates and signs the deploy with the ",(0,r.kt)("inlineCode",{parentName:"p"},"make-deploy")," command, indicating the account context under which the session code will be executed."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client make-deploy --chain-name casper-test \\\n--payment-amount 300000000 \\\n--session-path tests/wasm/contract.wasm \\\n--secret-key $PATH/user_1_secret_key.pem \\\n--session-arg \"my-key-name:string='user_1_key'\" \\\n--session-arg \"message:string='Hello, World'\" \\\n--session-account 01360af61b50cdcb7b92cffe2c99315d413d34ef77fadee0c105cc4f1d4120f986 \\\n--output hello_world_one_signature\n")),(0,r.kt)("p",null,"The second associated key signs the deploy with ",(0,r.kt)("inlineCode",{parentName:"p"},"sign-deploy")," to meet the deployment threshold for the account."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client sign-deploy -i hello_world_one_signature -k $PATH/user_2_secret_key.pem  -o hello_world_two_signatures\n")),(0,r.kt)("p",null,"The deploy can be sent to the network using the ",(0,r.kt)("inlineCode",{parentName:"p"},"send-deploy")," command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client send-deploy --node-address https://rpc.testnet.casperlabs.io -i hello_world_two_signatures\n")),(0,r.kt)("p",null,"Verify that the deploy ran successfully."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-deploy --node-address https://rpc.testnet.casperlabs.io/ <DEPLOY_HASH>\n")),(0,r.kt)("p",null,"Retrieve the latest state root hash and check the primary account details."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-state-root-hash --node-address https://rpc.testnet.casperlabs.io/\n\ncasper-client query-global-state \\\n--node-address https://rpc.testnet.casperlabs.io/ \\\n--state-root-hash <STATE_ROOT_HASH> \\\n--key account-hash-<PRIMARY_ACCOUNT_HASH>\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"hello_world.wasm")," should have run and added a named key to the account."),(0,r.kt)("h2",{id:"removing-a-compromised-key"},"Removing a Compromised Key"),(0,r.kt)("p",null,"This example shows how to remove a compromised key from an account. The example adds an associated key only to remove it using the ",(0,r.kt)("inlineCode",{parentName:"p"},"remove_account.wasm")," session code."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Remove keys with caution! Do not run this example on Mainnet."),(0,r.kt)("p",{parentName:"admonition"},"Before removing a key, ensure the remaining associated keys can combine their weight to meet the threshold for key management. Otherwise, the account could become unusable. Changing key weights or adding new associated keys would only be possible by meeting the key management threshold. Proceed with caution.")),(0,r.kt)("p",null,"Given the current setup, the primary account will add an associated key, and then remove it. In other use cases, associated keys may need to combine their signatures to send a multi-sig deploy that removes a key."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'casper-client put-deploy --node-address https://rpc.testnet.casperlabs.io/ \\\n--chain-name "casper-test" \\\n--payment-amount 500000000 \\\n--secret-key $PATH/secret_key.pem \\\n--session-path target/wasm32-unknown-unknown/release/add_account.wasm \\\n--session-arg "new_key:key=\'account-hash-1fed34baa6807a7868bb18f91b161d99ebf21763810fe4c92e39775d10bbf1f8" \\\n--session-arg "weight:u8=\'1\'"\n')),(0,r.kt)("p",null,"Verify that the deploy ran successfully."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-deploy --node-address https://rpc.testnet.casperlabs.io/ <DEPLOY_HASH>\n")),(0,r.kt)("p",null,"Retrieve the latest state root hash and check the primary account details."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-state-root-hash --node-address https://rpc.testnet.casperlabs.io/\n\ncasper-client query-global-state \\\n--node-address https://rpc.testnet.casperlabs.io/ \\\n--state-root-hash <STATE_ROOT_HASH> \\\n--key account-hash-<PRIMARY_ACCOUNT_HASH>\n")),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Account details"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"Account": {\n  "account_hash": "account-hash-1ed5a1c39bea93c105f2d22c965a84b205b36734a377d05dbb103b6bfaa595a7",\n  "action_thresholds": {\n    "deployment": 2,\n    "key_management": 3\n  },\n  "associated_keys": [\n    {\n      "account_hash": "account-hash-04a9691a9f8f05a0f08bd686f188b27c7dbcd644b415759fd3ca043d916ea02f",\n      "weight": 1\n    },\n    {\n      "account_hash": "account-hash-1fed34baa6807a7868bb18f91b161d99ebf21763810fe4c92e39775d10bbf1f8",\n      "weight": 1\n    },\n    {\n      "account_hash": "account-hash-1ed5a1c39bea93c105f2d22c965a84b205b36734a377d05dbb103b6bfaa595a7",\n      "weight": 3\n    },\n    {\n      "account_hash": "account-hash-e2d00525cac31ae2756fb155f289d276c6945b6914923fe275de0cb127bffee7",\n      "weight": 1\n    }\n  ],\n  "main_purse": "uref-8294864177c2c1ec887a11dae095e487b5256ce6bd2a1f2740d0e4f28bd3251c-007",\n  "named_keys": []\n}\n'))),(0,r.kt)("p",null,"The table below summarizes the updates after calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"add_account.wasm"),"."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Threshold / Key"),(0,r.kt)("th",{parentName:"tr",align:null},"Previous weight"),(0,r.kt)("th",{parentName:"tr",align:null},"Current weight"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"deployment")),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"2")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"key_management")),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"3")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Primary key (",(0,r.kt)("inlineCode",{parentName:"td"},"1ed5..."),")"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"3")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Associated key (",(0,r.kt)("inlineCode",{parentName:"td"},"04a9..."),")"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Associated key (",(0,r.kt)("inlineCode",{parentName:"td"},"e2d0..."),")"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Associated key (",(0,r.kt)("inlineCode",{parentName:"td"},"1fed..."),")"),(0,r.kt)("td",{parentName:"tr",align:null},"N/A"),(0,r.kt)("td",{parentName:"tr",align:null},"1")))),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"remove_account.wasm")," will remove the newly added account to demonstrate the possibility of removing associated keys that may have been compromised."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'casper-client put-deploy --node-address https://rpc.testnet.casperlabs.io/ \\\n--chain-name "casper-test" \\\n--payment-amount 500000000 \\\n--secret-key $PATH/secret_key.pem \\\n--session-path target/wasm32-unknown-unknown/release/remove_account.wasm \\\n--session-arg "remove_key:key=\'account-hash-1fed34baa6807a7868bb18f91b161d99ebf21763810fe4c92e39775d10bbf1f8"\n')),(0,r.kt)("p",null,"Verify that the deploy ran successfully."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-deploy --node-address https://rpc.testnet.casperlabs.io/ <DEPLOY_HASH>\n")),(0,r.kt)("p",null,"Retrieve the latest state root hash and check the primary account details."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-state-root-hash --node-address https://rpc.testnet.casperlabs.io/\n\ncasper-client query-global-state \\\n--node-address https://rpc.testnet.casperlabs.io/ \\\n--state-root-hash <STATE_ROOT_HASH> \\\n--key account-hash-<PRIMARY_ACCOUNT_HASH>\n")),(0,r.kt)("p",null,"The resulting account should not contain the associated key that was just removed."),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Account details"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"Account": {\n  "account_hash": "account-hash-1ed5a1c39bea93c105f2d22c965a84b205b36734a377d05dbb103b6bfaa595a7",\n  "action_thresholds": {\n    "deployment": 2,\n    "key_management": 3\n  },\n  "associated_keys": [\n    {\n      "account_hash": "account-hash-04a9691a9f8f05a0f08bd686f188b27c7dbcd644b415759fd3ca043d916ea02f",\n      "weight": 1\n    },\n    {\n      "account_hash": "account-hash-1ed5a1c39bea93c105f2d22c965a84b205b36734a377d05dbb103b6bfaa595a7",\n      "weight": 3\n    },\n    {\n      "account_hash": "account-hash-e2d00525cac31ae2756fb155f289d276c6945b6914923fe275de0cb127bffee7",\n      "weight": 1\n    }\n  ],\n  "main_purse": "uref-8294864177c2c1ec887a11dae095e487b5256ce6bd2a1f2740d0e4f28bd3251c-007",\n  "named_keys": []\n}\n'))),(0,r.kt)("p",null,"The table below summarizes the updates after calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"remove_account.wasm"),"."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Threshold / Key"),(0,r.kt)("th",{parentName:"tr",align:null},"Previous weight"),(0,r.kt)("th",{parentName:"tr",align:null},"Current weight"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"deployment")),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"2")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"key_management")),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"3")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Primary key (",(0,r.kt)("inlineCode",{parentName:"td"},"1ed5..."),")"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"3")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Associated key (",(0,r.kt)("inlineCode",{parentName:"td"},"04a9..."),")"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Associated key (",(0,r.kt)("inlineCode",{parentName:"td"},"e2d0..."),")"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"1")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Associated key (",(0,r.kt)("inlineCode",{parentName:"td"},"1fed..."),")"),(0,r.kt)("td",{parentName:"tr",align:null},"1"),(0,r.kt)("td",{parentName:"tr",align:null},"N/A (Removed)")))),(0,r.kt)("h2",{id:"next-steps"},"Next Steps"),(0,r.kt)("p",null,"The next section contains ",(0,r.kt)("a",{parentName:"p",href:"/resources/advanced/multi-sig/other-scenarios"},"additional examples")," where Casper's multi-signature feature would be helpful."))}h.isMDXComponent=!0}}]);