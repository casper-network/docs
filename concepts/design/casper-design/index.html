<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-concepts/design/casper-design">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Overview of a Casper Network | Casper</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.casperlabs.io/concepts/design/casper-design/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Overview of a Casper Network | Casper"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/icon/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.casperlabs.io/concepts/design/casper-design/"><link data-rh="true" rel="alternate" href="https://docs.casperlabs.io/concepts/design/casper-design/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.casperlabs.io/concepts/design/casper-design/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://KQNX60E7J5-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Casper" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.96b90404.css">
<link rel="preload" href="/assets/js/runtime~main.166f4f41.js" as="script">
<link rel="preload" href="/assets/js/main.f4823553.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#1c1e21;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">This documentation is changing to align with a new <b>Developer Portal</b> launching soon. Please excuse any disruptions.</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/icon/Casper_Wordmark_Red_RGB.png" alt="Casper Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/icon/Casper_Wordmark_White_RGB.png" alt="Casper Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate"></b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/concepts/">Concepts</a><a class="navbar__item navbar__link" href="/developers/">Developers</a><a class="navbar__item navbar__link" href="/operators/">Operators</a><a class="navbar__item navbar__link" href="/users/">Users</a><a class="navbar__item navbar__link" href="/resources/">Resources</a><a class="navbar__item navbar__link" href="/faq/">FAQ</a><a href="https://discord.com/invite/Q38s3Vh" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Chat<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/concepts/design/casper-design/" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/casper-network/docs-app" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/concepts/">Table of Contents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/concepts/accounts-and-keys/">Accounts and Cryptographic Keys</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/concepts/understanding-hash-types/">Understanding Hash Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/concepts/callstack/">Understanding Call Stacks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/concepts/session-code/">Contracts and Session Code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/concepts/dictionaries/">Reading and Writing to Dictionaries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/concepts/serialization-standard/">Serialization Standard</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/design/">Design</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/design/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/design/p2p/">Network Communication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/design/highway/">The Highway Consensus Protocol</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/concepts/design/casper-design/">Overview of a Casper Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/concepts/design/reading-and-writing-to-the-blockchain/">Reading and Writing Data to the Blockchain</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/economics/">Economics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/glossary/">Glossary</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Design</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Overview of a Casper Network</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Overview of a Casper Network</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2><p>Casper is a Proof-of-Stake blockchain platform with an account-based model that performs execution after consensus. A Casper network stores data on a structure known as <a href="#global-state-head">Global State</a>. Users interact with global state through session code sent in a <a href="#execution-semantics-deploys">Deploy</a>. Deploys contain <a href="https://webassembly.org/" target="_blank" rel="noopener noreferrer">Wasm</a> to be executed by the network, thus allowing developers to use their preferred programming language rather than a proprietary language.</p><p>A deploy executes in the context of the user&#x27;s <a href="#accounts-head">Account</a> but can call stored Wasm that will execute in its own context. User-related information other than an account is stored in global state as an <a href="#uref-head">Unforgeable Reference</a> or <code>URef</code>. After a node accepts a deploy as valid, it places the deploy in a proposed <a href="#block-structure-head">Block</a> and gossips it among nodes until the network reaches consensus. At this point, the network executes the Wasm included within the deploy.</p><ol><li><p><a href="#global-state-head">Global State</a></p></li><li><p><a href="#execution-semantics-head">Execution Semantics</a></p></li><li><p><a href="#accounts-head">Accounts</a></p></li><li><p><a href="#uref-head">Unforgeable Reference (URef)</a></p></li><li><p><a href="#block-structure-head">Block Structure</a></p></li><li><p><a href="#tokens-head">Tokens</a></p></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="global-state-head">Global State<a href="#global-state-head" class="hash-link" aria-label="Direct link to Global State" title="Direct link to Global State">​</a></h2><p>&quot;Global state&quot; is the storage layer for the Casper blockchain. All accounts, contracts, and any associated data are stored in global state. Global state follows the semantics of a key-value store (with additional permissions logic, as not all users can access all values in the same way).</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Refer to <a href="/concepts/serialization-standard/#serialization-standard-state-keys">Keys and Permissions</a> for further information on keys.</p></div></div><p>Changes to global state occur through executing deploys contained within finalized blocks. For validators to efficiently judge the correctness of these changes, they need information about the new state communicated succinctly. Further, the network must communicate portions of global state to users while allowing them to verify the correctness of the parts they receive. The key-value store is implemented as a <a href="#global-state-trie">Merkle trie</a> for these reasons.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="global-state-trie">Merkle Trie Structure<a href="#global-state-trie" class="hash-link" aria-label="Direct link to Merkle Trie Structure" title="Direct link to Merkle Trie Structure">​</a></h3><p><img loading="lazy" alt="Global State" src="/assets/images/global-state-54ea70dd3a537dc33f8dec6cc67fc5b7.png" width="1111" height="1021" class="img_ev3q"></p><p>At a high level, a Merkle trie is a key-value store data structure that can be shared piecewise in a verifiable way (via a construction called a Merkle proof). Each node is labeled by the hash of its data. Leaf nodes are labeled with the hash of their data. Non-leaf nodes are labeled with the hash of the labels of their child nodes.</p><p>Casper&#x27;s implementation of the trie has radix of 256, meaning each branch node can have up to 256 children. A path through the tree can be an array of bytes, and serialization directly links a key with a path through the tree as its associated value.</p><p>Formally, a trie node is one of the following:</p><ul><li>a leaf, which includes a key and a value</li><li>a branch, which has up to 256 <code>blake2b256</code> hashes, pointing to up to 256 other nodes in the trie (recall each node is labeled by its hash)</li><li>an extension node, which includes a byte array (called the affix) and a <code>blake2b256</code> hash pointing to another node in the trie</li></ul><p>The purpose of the extension node is to allow path compression. Consider an example where all keys use the same first four bytes for values in the trie. In this case, it would be inefficient to traverse through four branch nodes where there is only one choice; instead, the root node of the trie could be an extension node with an affix equal to those first four bytes and a pointer to the first non-trivial branch node.</p><p>The Rust implementation of Casper&#x27;s trie can be found on GitHub:</p><ul><li><a href="https://github.com/casper-network/casper-node/blob/dev/execution_engine/src/storage/trie/mod.rs#L475" target="_blank" rel="noopener noreferrer">Definition of the trie data structure</a></li><li><a href="https://github.com/casper-network/casper-node/blob/dev/execution_engine/src/storage/trie_store/operations/mod.rs#L45" target="_blank" rel="noopener noreferrer">Reading from the trie</a></li><li><a href="https://github.com/casper-network/casper-node/blob/dev/execution_engine/src/storage/trie_store/operations/mod.rs#L954" target="_blank" rel="noopener noreferrer">Writing to the trie</a></li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Conceptually, each block has its trie because the state changes based on the deploys it contains. For this reason, Casper&#x27;s implementation has a notion of a <code>TrieStore</code>, which allows us to look up the root node for each trie.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="execution-semantics-head">Execution Semantics<a href="#execution-semantics-head" class="hash-link" aria-label="Direct link to Execution Semantics" title="Direct link to Execution Semantics">​</a></h2><p>A Casper network is a decentralized computation platform. This section describes aspects of the Casper computational model.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="execution-semantics-gas">Measuring Computational Work<a href="#execution-semantics-gas" class="hash-link" aria-label="Direct link to Measuring Computational Work" title="Direct link to Measuring Computational Work">​</a></h3><p>Computation is done in a <a href="https://webassembly.org/" target="_blank" rel="noopener noreferrer">WebAssembly (Wasm)</a> interpreter, allowing any programming language which compiles to Wasm to become a smart contract language for the Casper blockchain. Similar to Ethereum, Casper uses <a href="/concepts/economics/gas-concepts/"><code>Gas</code></a> to measure computational work in a way that is consistent from node to node in a Casper network. Each Wasm opcode is assigned a <code>Gas</code> cost, and the amount of gas spent is tracked by the runtime with each opcode executed by the interpreter.</p><p>Costs for opcode instructions on the Casper Mainnet network can be found <a href="https://github.com/casper-network/casper-node/blob/dev/resources/production/chainspec.toml#L115" target="_blank" rel="noopener noreferrer">here</a>.</p><p>All executions are finite because each has a finite <em>gas limit</em> that specifies the maximum amount of gas available to spend before the runtime terminates the computation. The payment executable session determines how to pay for the deploy. The gas limit is set by executing the payment code specified within the deploy.</p><p>Although the network measures costs in <code>Gas</code>, payment for computation occurs in <a href="#tokens-divisibility">motes</a>. Therefore, there is a conversion rate between <code>Gas</code> and motes.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Please note that Casper will not refund any amount of unused gas.</p><p>This decision is taken to incentivize the <a href="/runtime/#runtime-economics">Casper Runtime Economics</a> by efficiently allocating the computational resources. The <a href="/runtime/#consensus-before-execution-basics-of-payment">consensus-before-execution model</a> implements the mechanism to encourage the optimized gas consumption from users and to prevent the overuse of block space by poorly handled deploys.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="execution-semantics-deploys">Deploys<a href="#execution-semantics-deploys" class="hash-link" aria-label="Direct link to Deploys" title="Direct link to Deploys">​</a></h3><p>A <a href="/concepts/serialization-standard/#serialization-standard-deploy">Deploy</a> is a data structure containing Wasm and the requester&#x27;s signature(s). Additionally, the deploy header contains additional metadata about the deploy itself. A deploy’s structure is as follows:</p><p align="center"><img loading="lazy" src="/image/design/deploy-structure.png" alt="Image showing the deploy data structure" width="500" class="img_ev3q"></p><ul><li>Body: Containing payment code and session code (more details on these below)</li><li>Header: containing<ul><li>The <a href="/concepts/serialization-standard/#publickey">Public Key</a> of the account in whose context the deploy will run</li><li>The timestamp of the deploy’s creation</li><li>A time-to-live, after which the deploy expires and cannot be included in a block</li><li>the <code>blake2b256</code> hash of the body</li></ul></li><li>Deploy hash: the <code>blake2b</code> hash of the Header</li><li>Approvals: the set of signatures which have signed the deploy hash; these are used in the <a href="#accounts-associated-keys-weights">account permissions model</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="execution-semantics-phases">Deploy Lifecycle<a href="#execution-semantics-phases" class="hash-link" aria-label="Direct link to Deploy Lifecycle" title="Direct link to Deploy Lifecycle">​</a></h3><p>A deploy goes through the following phases on Casper:</p><ol><li>Deploy Received</li><li>Deploy Gossiped</li><li>Block Proposed</li><li>Block Gossiped</li><li>Consensus Reached</li><li>Deploy Executed</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-received">Deploy Received<a href="#deploy-received" class="hash-link" aria-label="Direct link to Deploy Received" title="Direct link to Deploy Received">​</a></h4><p>A client sending the deploy will send it to one or more nodes via their JSON RPC servers. The node will ensure that a given deploy matches configuration settings outlined in the network&#x27;s chainspec. Deploy configuration for the Casper Mainnet can be found <a href="https://github.com/casper-network/casper-node/blob/dev/resources/production/chainspec.toml#L79" target="_blank" rel="noopener noreferrer">here</a>. Once accepted, the system returns the deploy hash to the client to indicate it has been enqueued for execution. The deploy could expire while waiting to be gossiped; whenever this happens, a <code>DeployExpired</code> event is emitted by the event stream servers of all nodes which have the expired deploy.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-gossiped">Deploy Gossiped<a href="#deploy-gossiped" class="hash-link" aria-label="Direct link to Deploy Gossiped" title="Direct link to Deploy Gossiped">​</a></h4><p>After a node accepts a new deploy, it will gossip to all other nodes. A validator node will put the deploy into the block proposer buffer. The validator leader will pick the deploy from the block proposer buffer to create a new proposed block for the chain. This mechanism is efficient and ensures all nodes in the network eventually hold the given deploy. Each node that accepts a gossiped deploy also emits a <code>DeployAccepted</code> event on its event stream server. The deploy may expire while waiting for a node to add it to the block. Whenever this happens, the node emits a <code>DeployExpired</code> event.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="block-proposed">Block Proposed<a href="#block-proposed" class="hash-link" aria-label="Direct link to Block Proposed" title="Direct link to Block Proposed">​</a></h4><p>The validator leader for this round will propose a block that includes as many deploys from the block proposer buffer as can fit in a block.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="block-gossiped">Block Gossiped<a href="#block-gossiped" class="hash-link" aria-label="Direct link to Block Gossiped" title="Direct link to Block Gossiped">​</a></h4><p>The proposed block propagates to all other nodes.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="consensus-reached">Consensus Reached<a href="#consensus-reached" class="hash-link" aria-label="Direct link to Consensus Reached" title="Direct link to Consensus Reached">​</a></h4><p>Once the other validators reach consensus that the proposed block is valid, all deploys in the block are executed, and this block becomes the final block added to the chain. Whenever reaching consensus, the event stream server emits a <code>BlockAdded</code>. <code>FinalitySignature</code> events emit shortly after that. Finality signatures for the new block arrive from the validators.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="deploy-executed">Deploy Executed<a href="#deploy-executed" class="hash-link" aria-label="Direct link to Deploy Executed" title="Direct link to Deploy Executed">​</a></h4><p>A deploy executes in distinct phases to accommodate flexibly paying for computation. The phases of a deploy are <em>payment</em>, <em>session</em>, and <em>finalization</em>. Payment code executes during the payment phase. If it is successful, the session code executes during the session phase. And, independently of session code execution, the finalization phase does some bookkeeping around the payment. Once the deploy is executed, a <code>DeployProcessed</code> event is emitted by the event stream server.</p><p>In the event of execution failure, the sender will be charged the minimum penalty payment - 2.5 CSPR on the Casper Mainnet. This prevents malicious spamming of faulty deploys.</p><p><strong>Payment code</strong></p><p><em>Payment code</em> determines the payment amount for the computation requested and how much the sender is willing to pay. Payment code may include arbitrary logic, providing flexibility in paying for a deploy. For example, the simplest payment code could use the account&#x27;s <a href="#tokens-purses-and-accounts">main purse</a>. In contrast, an enterprise application may require a multi-signature scheme that accesses a corporate purse. To ensure the payment code will pay for its own computation, only accounts with a balance in their main purse greater than or equal to <code>MAX_PAYMENT_COST</code> may execute deploys. Based on the current conversion rate between gas and motes, we restrict the gas limit of the payment code execution so that the process spends no more than <code>MAX_PAYMENT_COST</code> motes (a constant of the system.) If the payment is absent or not enough, then payment execution is not successful. In this case, the effects of the payment code on global state are reverted, and the system covers the cost of the computation with motes taken from the offending account&#x27;s main purse.</p><p><strong>Session code</strong></p><p><em>Session code</em> provides the main logic for the deploy. It only executes if the payment code is successful. The gas limit for this computation is determined based on the amount of payment given (after subtracting the cost of the payment code itself).</p><p><strong>Specifying payment code and session code</strong></p><p>The user-defined logic of a deploy can be specified in a number of ways:</p><ul><li>a Wasm module in binary format representing valid session code, including logic to be executed in the context of an account or to store Wasm in the form of a contract to be executed later. (Note that the named keys from the context of the account the deploy is running in.)</li><li>a 32-byte identifier representing the <a href="/concepts/serialization-standard/#serialization-standard-hash-key">hash</a> where a contract is already stored in the global state</li><li>a name corresponding to a named key in the account, where a contract is stored under the key</li></ul><p>Payment and session code can be independently specified, so different methods of specifying them may be used (e.g. payment could be specified by a hash key, while the session is explicitly provided as a Wasm module).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="execution-semantics-runtime">The Casper Network Runtime<a href="#execution-semantics-runtime" class="hash-link" aria-label="Direct link to The Casper Network Runtime" title="Direct link to The Casper Network Runtime">​</a></h3><p>A Wasm module is not natively able to create any effects outside of reading or writing from its own linear memory. Wasm modules must import functions from the host environment they are running in to enable other desired effects, such as reading or writing to global state.</p><p><img loading="lazy" alt="Casper Network Runtime" src="/assets/images/casper-runtime-9bc2eb0948168ce8a2eef7f037af6ba4.png" width="1220" height="604" class="img_ev3q"></p><p>All these features are accessible via functions in the <a href="https://docs.rs/casper-contract/1.4.4/casper_contract/ext_ffi/index.html" target="_blank" rel="noopener noreferrer">Casper External FFI</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="execution-semantics-urefs">Generating <code>URef</code>s<a href="#execution-semantics-urefs" class="hash-link" aria-label="Direct link to execution-semantics-urefs" title="Direct link to execution-semantics-urefs">​</a></h4><p><code>URef</code>s are generated using a <a href="https://rust-random.github.io/rand/rand_chacha/struct.ChaCha20Rng.html" target="_blank" rel="noopener noreferrer">cryptographically secure random number generator</a> using the <a href="https://cr.yp.to/chacha.html" target="_blank" rel="noopener noreferrer">ChaCha algorithm</a>. The random number generator is seeded by taking the <code>blake2b256</code> hash of the deploy hash concatenated with an index representing the current phase of execution (to prevent collisions between <code>URef</code>s generated in different phases of the same deploy).</p><p><img loading="lazy" alt="Generating URefs" src="/assets/images/generating-urefs-af02bd8d865f5da9599a205bb682678e.png" width="1121" height="289" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="accounts-head">Accounts<a href="#accounts-head" class="hash-link" aria-label="Direct link to Accounts" title="Direct link to Accounts">​</a></h2><p>The Casper blockchain uses an on-chain account-based model, uniquely identified by an <code>AccountHash</code> derived from a specific <code>PublicKey</code>. The <a href="#global-state-trie">global state trie store</a> requires all keys to be the same length, so the AccountHash is a 32-byte derivative used to abstract any of the supported public key variants.</p><p>The Casper platform supports two types of keys for creating accounts and signing transactions:</p><ul><li><a href="/concepts/accounts-and-keys/#eddsa-keys">ed25519</a> keys, which use the Edwards-curve Digital Signature Algorithm (EdDSA) and are 66 bytes long</li><li><a href="/concepts/accounts-and-keys/#ethereum-keys">secp256k1</a> keys, commonly known as Ethereum keys, which are 68 bytes long</li></ul><p>By default, a transactional interaction with the blockchain takes the form of a Deploy cryptographically signed by the key-pair corresponding to the PublicKey used to create the account. All user activity on the Casper blockchain (i.e., &quot;deploys&quot;) must originate from an account. Each account has its own context where it can locally store information (e.g., references to useful contracts, metrics, and aggregated data from other parts of the blockchain). Each account also has a &quot;main purse&quot; where it can hold Casper tokens (see <a href="#tokens-purses-and-accounts">Tokens</a> for more information).</p><p>This chapter describes the permission model for accounts and their local storage capabilities and briefly mentions some runtime functions for interacting with accounts.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="accounts-creating">Creating an account<a href="#accounts-creating" class="hash-link" aria-label="Direct link to Creating an account" title="Direct link to Creating an account">​</a></h3><p>Account creation automatically happens upon transferring tokens to a yet unused <code>PublicKey</code>. On account creation, the balance of its main purse is equal to the number of tokens transferred during the creation process. Its action thresholds are equal to 1, and there is one associated key. The associated key is the <code>PublicKey</code> used to create the account. In this way, an account is essentially a context object encapsulating the main purse, used to pay for transactions. However, an account may have an additional purse beyond the main purse.</p><p align="center"><img loading="lazy" src="/image/design/account-structure.png" alt="Image showing the account data structure" width="200" class="img_ev3q"></p><p>An <code>Account</code> contains the following data:</p><ul><li>A <code>URef</code> representing the account&#x27;s &quot;main purse&quot;</li><li>A collection of named keys (playing the same role as the named keys in a stored contract)</li><li>A collection of &quot;associated keys&quot; (see <a href="#accounts-associated-keys-weights">below for more information</a>)</li><li>&quot;Action thresholds&quot; (see <a href="#accounts-actions-thresholds">below for more information</a>)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="accounts-permissions">Permissions Model<a href="#accounts-permissions" class="hash-link" aria-label="Direct link to Permissions Model" title="Direct link to Permissions Model">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="accounts-actions-thresholds">Actions and Thresholds<a href="#accounts-actions-thresholds" class="hash-link" aria-label="Direct link to Actions and Thresholds" title="Direct link to Actions and Thresholds">​</a></h4><p>An account can perform two types of actions: sending deploys and managing keys. A deploy is simply executing some code on the blockchain, while key management involves changing the associated keys (which will be described in more detail later). Key management cannot be performed independently, as all effects on the blockchain must come via a deploy; therefore, a key management action implies that a deploy action is also taking place.</p><p>The <code>ActionThresholds</code> contained in the <code>Account</code> data structure set a <code>Weight</code>, which must be met to perform that action. The next section describes these weight thresholds. Since a key management action requires a deploy action, the key management threshold should always be greater than or equal to the deploy threshold.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="accounts-associated-keys-weights">Associated Keys and Weights<a href="#accounts-associated-keys-weights" class="hash-link" aria-label="Direct link to Associated Keys and Weights" title="Direct link to Associated Keys and Weights">​</a></h4><p>Accounts on a Casper network can associate other key pairs through a multiple signature scheme for sending transactions. An account&#x27;s <em>associated keys</em> are the set of public keys allowed to provide signatures on deploys for that account. Each associated key has a weight; these weights combine to meet the action thresholds provided in the previous section. Each deploy must be signed by one or more keys associated with the account that deploy is for, and the sum of the weights of those keys must be greater than or equal to the deployment threshold weight for that account. We call the keys that have signed a deploy the &quot;authorizing keys&quot;. Similarly, if a deploy contains key management actions (detailed below), the sum of the weights of the authorizing keys must be greater than or equal to the key management action threshold of the account.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Any key may help authorize any action; there are no &quot;special keys&quot;. All keys contribute their weight in exactly the same way.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="accounts-key-management">Key Management Actions<a href="#accounts-key-management" class="hash-link" aria-label="Direct link to Key Management Actions" title="Direct link to Key Management Actions">​</a></h4><p>A <em>key management action</em> is a change to the account permissions, including:</p><ul><li>Adding or removing an associated key</li><li>Changing the weight of an associated key</li><li>Changing the threshold of any action</li></ul><p>Key management actions have validity rules preventing users from locking themselves out of their accounts. For example, one can set a threshold, at most, the sum of the weights of all associated keys.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="accounts-recovery">Account security and recovery using key management<a href="#accounts-recovery" class="hash-link" aria-label="Direct link to Account security and recovery using key management" title="Direct link to Account security and recovery using key management">​</a></h4><p>This permissions model&#x27;s purpose is to keep accounts safe from lost or stolen keys while allowing the usage of modern mobile devices. For example, it may be convenient to sign deploys from a smartphone without worrying about the repercussions of losing the phone. The recommended setup is to have a low-weight key on the phone, enough for the deploy threshold but not enough for key management. If the phone is lost or stolen, a key management action using other associated keys from another device (e.g., a home computer) can be used to remove the lost associated key and add a key that resides on a replacement phone.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>It is extremely important to ensure there will always be access to a sufficient number of keys to perform the key management action. Otherwise, future recovery will be impossible (Casper currently does not support &quot;inactive recovery&quot;).</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="accounts-context">The Account Context<a href="#accounts-context" class="hash-link" aria-label="Direct link to The Account Context" title="Direct link to The Account Context">​</a></h3><p>A deploy is a user request to perform some execution on the blockchain (see <a href="#execution-semantics-head">Execution Semantics</a> for more information). It contains &quot;payment code&quot; and &quot;session code&quot;, which are references to stored on-chain contracts or Wasm to be executed. For executable Wasm, its execution and the logic therein occur within the context of the account signing the deploy. This means that the executing Wasm has access to the named keys and main purse of the account&#x27;s context.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>In the case where there is a reference to stored on-chain Wasm (smart contracts), the execution of the on-chain Wasm will occur in its own separate runtime context. As a result, the stored Wasm will not have access to the named keys or main purse of the calling account.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="uref-head">Unforgeable Reference (URef)<a href="#uref-head" class="hash-link" aria-label="Direct link to Unforgeable Reference (URef)" title="Direct link to Unforgeable Reference (URef)">​</a></h2><p>This key type is used for storing any value except <code>Account</code>. Additionally, <code>URef</code>s used in Wasm carry permission information to prevent unauthorized usage of the value stored under the key. The runtime tracks this permission information. This means that if malicious Wasm attempts to produce a <code>URef</code> with permissions that the Wasm does not have, the Wasm has attempted to &quot;forge&quot; the unforgeable reference, and the runtime will raise a forged <code>URef</code> error. Permissions for a <code>URef</code> can be given across contract calls, allowing data stored under a <code>URef</code> to be shared in a controlled way. The 32-byte identifier representing the key is generated randomly by the runtime (see <a href="#execution-semantics-head">Execution Semantics</a> for more information). The serialization for <code>Access Rights</code> that define the permissions for <code>URefs</code> is detailed in the <a href="/concepts/serialization-standard/">CLValues</a> section.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="uref-permissions">Permissions for <code>URef</code>s<a href="#uref-permissions" class="hash-link" aria-label="Direct link to uref-permissions" title="Direct link to uref-permissions">​</a></h3><p>In the runtime, a <code>URef</code> carries its permissions called <code>AccessRights</code>. Additionally, the runtime tracks what <code>AccessRights</code> would be valid for each <code>URef</code> in each context. The system assumes that a sent <code>URef</code> is invalid, regardless of declared <code>AccessRights</code>, and will check it against the executing context to determine validity on each usage. Only the host logic can add a <code>URef</code>, in the following ways:</p><ul><li>It can exist in a set of &quot;known&quot; <code>URef</code>s</li><li>It can be freshly created by the runtime via the <code>new_uref</code> function</li><li>For called contracts, the caller can pass it in via the arguments to <code>call_contract</code></li><li>It can be returned to the caller from <code>call_contract</code> via the <code>ret</code> function</li></ul><p>Note that only valid <code>URef</code>s may be added to the known <code>URef</code>s or cross-call boundaries; this means the system cannot be tricked into accepting a forged <code>URef</code> by getting it through a contract or stashing it in the known <code>URef</code>s.</p><p>The ability to pass <code>URef</code>s between contexts via <code>call_contract</code> / <code>ret</code>, allows them to share state among a fixed number of parties while keeping it private from all others.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="urefs-and-purses"><code>URef</code>s and Purses<a href="#urefs-and-purses" class="hash-link" aria-label="Direct link to urefs-and-purses" title="Direct link to urefs-and-purses">​</a></h3><p>Purses represent a unique type of <code>URef</code> used for accounting measures within a Casper network. <code>URef</code>s exist as a top-level entity, meaning that individual accounts do not own ‘URef’s. As described above, accounts and contracts possess certain <code>Access Rights</code>, allowing them to interact with the given <code>URef</code>. While an account will possess an associated <code>URef</code> representing their main purse, this <code>URef</code> exists as a <a href="/concepts/serialization-standard/#clvalue-unit"><code>Unit</code></a> and corresponds to a <em>balance</em> key within the Casper <em>mint</em>. The individual balance key within the Casper mint is the account&#x27;s purse, with transfers authorized solely through the associated <code>URef</code> and the <code>Access Rights</code> granted to it.</p><p>Through this logic, the Casper mint holds all motes on the network and transfers between balance keys at the behest of accounts and contracts as required.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="block-structure-head">Block Structure<a href="#block-structure-head" class="hash-link" aria-label="Direct link to Block Structure" title="Direct link to Block Structure">​</a></h2><p>A <em>block</em> is the primary data structure by which network nodes communicate information about the state of a Casper network. We briefly describe here the format of this data structure.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="block-structure-data">Data Fields<a href="#block-structure-data" class="hash-link" aria-label="Direct link to Data Fields" title="Direct link to Data Fields">​</a></h3><p>A block consists of the following:</p><ul><li>A <code>block_hash</code></li><li>A header</li><li>A body</li></ul><p>Each of these fields is detailed in the subsequent sections.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="block_hash"><code>block_hash</code><a href="#block_hash" class="hash-link" aria-label="Direct link to block_hash" title="Direct link to block_hash">​</a></h4><p>The <code>block_hash</code> is the <code>blake2b256</code> hash of the block header.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="header">Header<a href="#header" class="hash-link" aria-label="Direct link to Header" title="Direct link to Header">​</a></h4><p>The <a href="/concepts/serialization-standard/#serialization-standard-block">block header</a> contains the following fields:</p><ul><li><p><code>parent_hash</code></p><p>A list of <code>block_hash</code>es giving the parents of the block.</p></li><li><p><code>state_root_hash</code></p><p>The global state root hash produced by executing this block&#x27;s body.</p></li><li><p><code>body_hash</code></p><p>The hash of the block body.</p></li><li><p><code>random_bit</code></p><p>A boolean needed for initializing a future era.</p></li><li><p><code>accumulated_seed</code></p><p>A seed needed for initializing a future era.</p></li><li><p><code>era_end</code></p><p>Contains equivocation and reward information to be included in the terminal finalized block. It is an optional field.</p></li><li><p><code>timestamp</code></p><p>The timestamp from when the block was proposed.</p></li><li><p><code>era_id</code></p><p>Era ID in which this block was created.</p></li><li><p><code>height</code></p><p>The height of this block, i.e., the number of ancestors.</p></li><li><p><code>protocol_version</code></p><p>The version of the Casper network when this block was proposed.</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="body">Body<a href="#body" class="hash-link" aria-label="Direct link to Body" title="Direct link to Body">​</a></h4><p>The block body contains an <strong>ordered</strong> list of <code>DeployHashes</code> which refer to deploys, and an <strong>ordered</strong> list of <code>DeployHashes</code> for native transfers (which are specialized deploys that only transfer tokens between accounts). All deploys, including a specialization such as native transfer, can be broadly categorized as some unit of work that, when executed and committed, affect change to <a href="#global-state-intro">Global State</a>. A valid block may contain no deploys and / or native transfers.</p><p>The block body also contains the public key of the validator that proposed the block.</p><p>Refer to the <a href="/concepts/serialization-standard/">Serialization Standard</a> for additional information on how blocks and deploy are serialized.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tokens-head">Tokens<a href="#tokens-head" class="hash-link" aria-label="Direct link to Tokens" title="Direct link to Tokens">​</a></h2><p>Casper is a decentralized Proof-of-Stake blockchain platform that uses a consensus algorithm called <a href="/concepts/design/highway/">Highway</a>. Having a unit of value is required to make this system work because users must pay for computation, and validators must have <a href="/staking/">stake</a> to bond. In the blockchain space, this unit of value is a <em>token</em>.</p><p>This chapter describes tokens and how one can use them on the Casper platform.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="token-generation-and-distribution">Token Generation and Distribution<a href="#token-generation-and-distribution" class="hash-link" aria-label="Direct link to Token Generation and Distribution" title="Direct link to Token Generation and Distribution">​</a></h3><p>A blockchain system generally needs a supply of tokens available to pay for computation and reward validators for processing transactions on the network. The initial supply at the launch of Mainnet was 10 billion CSPR. The current supply is available <a href="https://api.cspr.live/supply" target="_blank" rel="noopener noreferrer">here</a>. In addition to the initial supply, the system will have a low rate of inflation, the results of which will be paid out to validators in the form of seigniorage.</p><p>The number of tokens used to calculate seigniorage is the initial supply of tokens at genesis.</p><p align="center"><img loading="lazy" src="/image/design/token-lifecycle.png" alt="Image showing the token lifecycle" width="700" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tokens-divisibility">Divisibility of Tokens<a href="#tokens-divisibility" class="hash-link" aria-label="Direct link to Divisibility of Tokens" title="Direct link to Divisibility of Tokens">​</a></h3><p>Typically, a <em>token</em> is divisible into some number of parts. We call the indivisible units which make up the CSPR token <em>motes</em>. Each CSPR is divisible into 10<sup>9</sup> motes. To avoid rounding errors, it is essential to always represent token balances in motes. In comparison, Ether is divisible into 10<sup>18</sup> parts called Wei.</p><p>The concept of <code>CSPR</code> is human-readable convenience and does not exist within the actual infrastructure of a Casper network. Instead, all transactions deal solely with <em>motes</em>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tokens-purses-and-accounts">Purses and Accounts<a href="#tokens-purses-and-accounts" class="hash-link" aria-label="Direct link to Purses and Accounts" title="Direct link to Purses and Accounts">​</a></h3><p>All <a href="#accounts-head">accounts</a> on the Casper system have a purse associated with the Casper system mint, called the <em>main purse</em>. However, for security reasons, the <code>URef</code> of the main purse is only available to code running in the context of that account (i.e. only in payment or session code). Therefore, the mint&#x27;s <code>transfer</code> method that accepts <code>URef</code>s is not the most convenient when transferring between account main purses. For this reason, Casper supplies a <a href="https://docs.rs/casper-contract/latest/casper_contract/contract_api/system/fn.transfer_to_account.html" target="_blank" rel="noopener noreferrer">transfer_to_account</a> function, which takes the public key used to derive the identity key of the account. This function uses the mint transfer function with the current account&#x27;s main purse as the <code>source</code> and the main purse of the account at the provided key as the <code>target</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mint-contract">The Casper Mint Contract<a href="#mint-contract" class="hash-link" aria-label="Direct link to The Casper Mint Contract" title="Direct link to The Casper Mint Contract">​</a></h3><p>The Casper <em>mint</em> is a system contract that manages the balance of <em>motes</em> within a Casper network. These motes are used to pay for computation and bonding on the network. The mint system contract holds all motes on a Casper network but maintains an internal ledger of the balances for each Account&#x27;s <em>main purse</em>. Each balance is associated with a <code>URef</code>, which is a key to instruct the mint to perform actions on that balance (e.g., transfer motes). Informally, these balances are referred to as <em>purses</em> and conceptually represent a container for motes. The <code>URef</code> is how a purse is referenced externally, outside the mint.</p><p>The <code>AccessRights</code> of the URefs permissions model determines what actions can be performed when using a <code>URef</code> associated with a purse.</p><p>As all URef<code>s are unforgeable, the only way to interact with a purse is for a </code>URef<code>with appropriate</code>AccessRights` to be validly given to the current context.</p><p>The basic global state options map onto more standard monetary operations according to the table below:</p><table><thead><tr><th>Global State</th><th>Action Monetary Action</th></tr></thead><tbody><tr><td>Add</td><td>Deposit (i.e. transfer to)</td></tr><tr><td>Write</td><td>Withdraw (i.e. transfer from) Read Balance check</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tokens-mint-interface">The mint Contract Interface<a href="#tokens-mint-interface" class="hash-link" aria-label="Direct link to The mint Contract Interface" title="Direct link to The mint Contract Interface">​</a></h2><p>The mint system contract exposes the following methods:</p><ul><li><code>transfer(source: URef, target: URef, amount: Motes) -&gt; TransferResult</code><ul><li><code>source</code> must have at least <code>Write</code> access rights, <code>target</code> must have at least <code>Add</code> access rights</li><li><code>TransferResult</code> may be a success acknowledgment or an error in the case of invalid <code>source</code> or <code>target</code> or insufficient balance in the <code>source</code> purse</li></ul></li><li><code>mint(amount: Motes) -&gt; MintResult</code><ul><li><code>MintResult</code> either gives the created <code>URef</code> (with full access rights), which now has a balance equal to the given <code>amount</code>; or an error due to the minting of new motes not being allowed</li><li>In the Casper mint, only the system account can call <code>mint</code>, and it has no private key to produce valid cryptographic signatures, which means only the software itself can execute contracts in the context of the system account</li></ul></li><li><code>create() -&gt; URef</code><ul><li>a convenience function for <code>mint(0)</code> which cannot fail because it is always allowed to create an empty purse</li></ul></li><li><code>balance(purse: URef) -&gt; Option&lt;Motes&gt;</code><ul><li><code>purse</code> must have at least <code>Read</code> access rights</li><li><code>BalanceResult</code> either returns the number of motes held by the <code>purse</code>, or nothing if the <code>URef</code> is not valid</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/casper-network/docs/tree/main/source/docs/casper/concepts/design/casper-design.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-03-13T14:38:36.000Z">Mar 13, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/concepts/design/highway/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">The Highway Consensus Protocol</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/concepts/design/reading-and-writing-to-the-blockchain/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Reading and Writing Data to the Blockchain</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#global-state-head" class="table-of-contents__link toc-highlight">Global State</a><ul><li><a href="#global-state-trie" class="table-of-contents__link toc-highlight">Merkle Trie Structure</a></li></ul></li><li><a href="#execution-semantics-head" class="table-of-contents__link toc-highlight">Execution Semantics</a><ul><li><a href="#execution-semantics-gas" class="table-of-contents__link toc-highlight">Measuring Computational Work</a></li><li><a href="#execution-semantics-deploys" class="table-of-contents__link toc-highlight">Deploys</a></li><li><a href="#execution-semantics-phases" class="table-of-contents__link toc-highlight">Deploy Lifecycle</a></li><li><a href="#execution-semantics-runtime" class="table-of-contents__link toc-highlight">The Casper Network Runtime</a></li></ul></li><li><a href="#accounts-head" class="table-of-contents__link toc-highlight">Accounts</a><ul><li><a href="#accounts-creating" class="table-of-contents__link toc-highlight">Creating an account</a></li><li><a href="#accounts-permissions" class="table-of-contents__link toc-highlight">Permissions Model</a></li><li><a href="#accounts-context" class="table-of-contents__link toc-highlight">The Account Context</a></li></ul></li><li><a href="#uref-head" class="table-of-contents__link toc-highlight">Unforgeable Reference (URef)</a><ul><li><a href="#uref-permissions" class="table-of-contents__link toc-highlight">Permissions for <code>URef</code>s</a></li><li><a href="#urefs-and-purses" class="table-of-contents__link toc-highlight"><code>URef</code>s and Purses</a></li></ul></li><li><a href="#block-structure-head" class="table-of-contents__link toc-highlight">Block Structure</a><ul><li><a href="#block-structure-data" class="table-of-contents__link toc-highlight">Data Fields</a></li></ul></li><li><a href="#tokens-head" class="table-of-contents__link toc-highlight">Tokens</a><ul><li><a href="#token-generation-and-distribution" class="table-of-contents__link toc-highlight">Token Generation and Distribution</a></li><li><a href="#tokens-divisibility" class="table-of-contents__link toc-highlight">Divisibility of Tokens</a></li><li><a href="#tokens-purses-and-accounts" class="table-of-contents__link toc-highlight">Purses and Accounts</a></li><li><a href="#mint-contract" class="table-of-contents__link toc-highlight">The Casper Mint Contract</a></li></ul></li><li><a href="#tokens-mint-interface" class="table-of-contents__link toc-highlight">The mint Contract Interface</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright"><div class="footer-inner-container">
    <div class="footer-top">
        <ul class="items">
            <li><a href="https://arxiv.org/pdf/2101.02159.pdf" target="_blank" rel="noopener">White Paper</a></li>
            <li>
                <a href="https://docs.casperlabs.io" target="_blank" rel="noopener"> Docs </a>
            </li>
            <li><a href="https://devxdao.com/" target="_blank" rel="noopener">Grant Program</a></li>
            <li><a href="https://casper.network/network/casper-association" target="_blank" rel="noopener">Casper Association</a></li>
        </ul>
    </div>
    <div class="footer-bottom">
        <ul class="items left">
            <li>
                <a href="https://casper.network/en/network" target="_blank" rel="noopener">
                    <img class="footer-logo" src="/icon/Casper_Wordmark_White_RGB.png" alt="Casper Logo">
                </a>
            </li>
            <li>© 2023 Casper Association</li>
        </ul>
        <ul class="items right">
            <li class="trademark">
                <a href="https://casper.network/network/trademark-policy" target="_blank" rel="noopener">Trademark Policy and Guidelines</a>
            </li>
        </ul>
    </div>
</div>
</div></div></div></footer></div>
<script src="/assets/js/runtime~main.166f4f41.js"></script>
<script src="/assets/js/main.f4823553.js"></script>
</body>
</html>